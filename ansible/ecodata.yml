- hosts: all
  vars:
    tomcat: "tomcat7"
    tomcat_user: "tomcat7"
    es_version: "7.17.9"
    es_heap_dump_path: "/data/elasticsearch"
    es_tmp_dir: "/data/elasticsearch"
    es_api_host: "{{ elasticsearch_primary_host | default('localhost') }}"
    es_config:
      network.host: "{{ elasticsearch_primary_host | default('localhost') }}"
      discovery.type: "single-node"
# This is needed for the biocollect all sites query.
      indices.query.bool.max_clause_count: 8192
      # Set these values higher due to ongoing issues with not enough disk space.
      cluster.routing.allocation.disk.watermark.low: 90%
      cluster.routing.allocation.disk.watermark.high: 95%
      cluster.routing.allocation.disk.watermark.flood_stage: 99%
    nginx_remove_default_vhost: True
    nginx_client_body_timeout: "10"
    nginx_client_header_timeout: "10"
    nginx_large_client_header_buffers: "4 4k"
    ala_default_vhost_include_paths: False
#    nginx_content_security_policy: "script-src 'self' 'unsafe-inline' 'unsafe-eval' data: https://www.google-analytics.com https://maps.googleapis.com https://ssl.google-analytics.com https://www.google.com https://www.gstatic.com; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; worker-src blob:"
# ecodata-dev config for graphql browser
    nginx_content_security_policy: "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net data: https://www.google-analytics.com https://maps.googleapis.com https://ssl.google-analytics.com https://www.google.com https://www.gstatic.com; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; worker-src blob:"

  roles:
    - common
    - java
    - { role: mongodb-org, dbPath: "{{ ecodata_dbPath }}"}
    - { role: tomcat, when: packaging == "war" or install_geoserver }
    - webserver
    - { role: geoserver, log_filename: "geoserver" , when: install_geoserver | bool}
    - { role: ansible-elasticsearch, es_templates: false, es_instance_name: 'ecodata-elasticsearch', es_data_dirs: ['/data/elasticsearch'], tags: ['elasticsearch'], when: install_elasticsearch | bool }
    - ecodata
