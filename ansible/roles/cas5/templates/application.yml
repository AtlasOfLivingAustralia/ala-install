info:
  description: ALA CAS Configuration
server:
  port: {{ cas_server_port | default('9000') }}
  session:
    timeout: {{ cas_session_timeout | default('86400') }}  # seconds, 24 hours
  ssl:
    enabled: false
    key-store: 
jndi:
  hikari:
    - name: jdbccas
      driverClass: com.mysql.jdbc.Driver
      url: jdbc:mysql://{{ cas_db_hostname | default('localhost') }}:{{ cas_db_port | default('3306') }}/{{ cas_db_name | default('emmet') }}?serverTimezone={{ server_tz | default('Australia/Sydney') }}&zeroDateTimeBehavior=convertToNull
      user: {{ cas_db_username | default('cas') }}
      password: {{ cas_db_password | default('password') }}
      dataSourceProperties:
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
flyway:
  baselineOnMigrate: {{ cas_db_migration_baseline | default('true') }}
  url: jdbc:mysql://{{ cas_db_hostname | default('localhost') }}:{{ cas_db_port | default('3306') }}/{{ cas_db_name | default('emmet') }}?serverTimezone={{ server_tz | default('Australia/Sydney') }}&zeroDateTimeBehavior=convertToNull
  user: {{ cas_flyway_username | default('root') }}
  password: {{ cas_flyway_password | default('password') }}

logging:
  config: "{{ log4j2_config_location | default('file:/data/cas/config/log4j2.xml') }}"

cas:
  server:
    name: {{ cas_server_name }}
    prefix: ${cas.server.name}/{{ cas_context_path | default('cas') }}
  adminPagesSecurity:
    ip: {{ cas_admin_pages_ip | default('.*') }}
    actuatorEndpointsEnabled: true
  jdbc:
    showSql: false
  authn:
    jdbc:
      query:
        - dataSourceName: java:comp/env/jdbccas
        - dataSourceName: java:comp/env/jdbccas
    attributeRepository:
      jdbc:
        - dataSourceName: java:comp/env/jdbccas
    pac4j:
      typedIdUsed: true
      facebook:
        # fields:
        id: {{ pac4j_facebook_consumer_key }}
        secret: {{ pac4j_facebook_consumer_secret }}
        scope: public_profile,email
      twitter:
        id: {{ pac4j_twitter_consumer_key }}
        secret: {{ pac4j_twitter_consumer_secret }}
      google:
        scope: EMAIL_AND_PROFILE
        id: {{ pac4j_google_consumer_key }}
        secret: {{ pac4j_google_consumer_secret }}
    oidc:
      issuer: ${cas.server.name}/cas/oidc
      jwksFile: file:/data/cas/keystore.jwks
  monitor:
    endpoints:
      enabled: true
    jdbc:
      validationQuery: /* ping */ SELECT 1
      dataSourceName: java:comp/env/jdbccas
  serviceRegistry:
    initFromJson: true
    mongo:
      sslEnabled: {{ cas_services_ssl_enabled | default('false') }}
      clientUri: {{ cas_services_uri | default('') }}
      host: {{ cas_services_host | default('localhost') }}
      port: {{ cas_services_port | default('27017') }}
      replicaSet: {{ cas_services_replica_set | default('') }}
      collection: {{ cas_services_collection | default('services') }}
      databaseName: {{ cas_services_db | default('cas-service-registry') }}
      authenticationDatabaseName: {{ cas_services_auth_db | default('') }}
      userId: {{ cas_services_username | default('cas') }}
      password: {{ cas_services_password | default('password') }}
  ticket:
    rememberMe:
      enabled: true
    registry:
      mongo:
        sslEnabled: {{ cas_tickets_ssl_enabled | default('false') }}
        clientUri: {{ cas_tickets_uri | default('') }}
        host: {{ cas_tickets_host | default('localhost') }}
        port: {{ cas_tickets_port | default('27017') }}
        replicaSet: {{ cas_tickets_replica_set | default('') }}
        databaseName: {{ cas_tickets_db | default('cas-ticket-registry') }}
        authenticationDatabaseName: {{ cas_tickets_auth_db | default('') }}
        userId: {{ cas_tickets_username | default('cas') }}
        password: {{ cas_tickets_password | default('password') }}
  tgc:
    crypto:
      enabled: false
  webflow:
    crypto:
      signing:
        key: {{ cas_webflow_signing_key }}
      encryption:
        key: {{ cas_webflow_encryption_key }}

ala:
  cookie:
    domain: {{ auth_cookie_domain | default('ala.org.au') }}
    secure: {{ auth_cookie_secure | default('false') }}
    httpOnly: {{ auth_cookie_httpOnly | default('true') }}
    maxAge: {{ auth_cookie_maxAge | default('-1') }}
    name: {{ auth_cookie_name | default('ALA-Auth') }}
    path: {{ auth_cookie_path | default('/') }}
  creator:
    userCreatePassword: {{ user_create_password }}
    jdbc:
      dataSourceName: java:comp/env/jdbccas
  skin:
    baseUrl: {{ ala_base_url | default('https://www.ala.org.au')}}
    headerFooterUrl: {{ header_and_footer_baseurl | default('${ala.skin.baseUrl}/commonui-bs3')}}/
    favIconBaseUrl: {{ skin_favicon_baseurl | default('${ala.skin.baseUrl}/wp-content/themes/ala-wordpress-theme/img/favicon/') }}
    bieBaseUrl: {{ bie_base_url | default('https://bie.ala.org.au')}}
    bieSearchPath: {{ bie_search_path | default('/search') }}
    userDetailsUrl: {{ userdetails_base_url }}/{{ userdetails_context_path | default('userdetails') }}/
    orgShortName: {{ orgNameShort | default('ALA') }}
    orgLongName: {{ orgNameLong | default('Atlas of Living Australia') }}
    orgNameKey: {{ orgNameKey | default('ala') }}

# Enable these for Spring Boot actuator (required for Spring Boot Admin client)

endpoints:
  enabled: {{ endpoints_enabled }}
security:
  user:
    name: {{ cas_endpoint_user | default('admin') }}
    password: {{ cas_endpoint_password | default('secret') }}
    role:
      - ACTUATOR
  basic:
    enabled: true
    authorizeMode: role
    realm: ALA CAS
    path:
      - /status/**
management:
  security:
    enabled: true
    roles: ACTUATOR

spring:
{% if bootadmin_enabled %}
  boot:
    admin:
      url: {{ bootadmin_url | default('https://bootadmin.ala.org.au') }}
      username: {{ bootadmin_username }}
      password: {{ bootadmin_password }}
      client:
        enabled: true
        service-base-url: ${cas.server.name}
        managementUrl: ${cas.server.prefix}/status
        name: ALA CAS
        metadata:
          user:
            name: ${security.user.name}
            password: ${security.user.password}
{% endif %}
  session:
    store-type: {{ spring_session_store_type | default('none') }}
    {% if spring_session_store_type == 'redis' %}disable-redis-config-action: {{ is_secured_redis | default('false') | bool }}
    redis:
      namespace: {{ cas_redis_namespace | default('cas') }}
  redis:
    host: {{ spring_session_redis_host }}
    password: {{ spring_session_redis_password }}
    port: {{ spring_session_redis_port | default('6379') }}
{% endif %}