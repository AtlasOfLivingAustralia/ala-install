---
# Ensure external named volumes exist for databases
# This prevents accidental deletion of database data

- name: "Database volumes: Create MySQL named volume if not exists"
  shell: |
    docker volume inspect mysql_data > /dev/null 2>&1 || \
    docker volume create mysql_data
  changed_when: false
  tags:
    - db-init
    - docker-volumes

- name: "Database volumes: Create PostgreSQL named volume if not exists"
  shell: |
    docker volume inspect pgdata > /dev/null 2>&1 || \
    docker volume create pgdata
  changed_when: false
  tags:
    - db-init
    - docker-volumes

- name: "Database volumes: Create MongoDB named volume if not exists"
  shell: |
    docker volume inspect mongo_data > /dev/null 2>&1 || \
    docker volume create mongo_data
  changed_when: false
  tags:
    - db-init
    - docker-volumes

- name: "Database volumes: Verify all volumes exist"
  shell: |
    docker volume ls --filter name="mysql_data|pgdata|mongo_data" --format "table {{.Name}}"
  register: volume_list
  changed_when: false
  tags:
    - db-init
    - docker-volumes

- name: "Database volumes: Summary"
  debug:
    msg: |
      âœ… Database volumes verified:
      {{ volume_list.stdout }}
  tags:
    - db-init
    - docker-volumes
