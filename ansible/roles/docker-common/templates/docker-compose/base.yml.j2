---
# Docker Compose Base Template - Main Orchestrator
# This file includes all service definitions from separate files
# Services are organized by function: infrastructure/ and services/

name: la

include:
{% if i18n.enabled and i18n.strategy == 'volume' and i18n.volume.source == 'init-container' %}
  - ./infrastructure/i18n.yml
{% endif %}
{% if 'nginx' in services_enabled %}
  - ./infrastructure/nginx.yml
{% endif %}
  - ./infrastructure/mysql.yml
  - ./infrastructure/postgres.yml
  - ./infrastructure/mongodb.yml
  - ./infrastructure/db-backup.yml
{% if 'cas' in services_enabled or groups['cas-servers'] is defined %}
  - ./services/cas.yml
  - ./services/userdetails.yml
  - ./services/apikey.yml
  - ./services/cas-management.yml
{% endif %}
{% if 'species-list' in services_enabled or groups['species-list'] is defined %}
  - ./services/species-list.yml
{% endif %}
{% if 'collectory' in services_enabled %}
  - ./services/collectory.yml
{% endif %}
{% if 'gatus' in services_enabled or gatus_enabled | default(true) %}
  - ./infrastructure/gatus.yml
{% endif %}

# Global networks and volumes
networks:
  {{ docker_network | default('internal') }}:
{% if deployment_type == 'swarm' %}
    external: true
{% else %}
    driver: bridge
{% endif %}

volumes:
{% if i18n.enabled and i18n.strategy == 'volume' %}
  {{ i18n.volume.name }}:
{% endif %}
  la_mysql-data:
    external: true
  la_postgres-data:
    external: true
  la_mongodb-data:
    external: true
{% if 'gatus' in services_enabled or gatus_enabled | default(true) %}
  la_gatus-data:
    external: true
{% endif %}