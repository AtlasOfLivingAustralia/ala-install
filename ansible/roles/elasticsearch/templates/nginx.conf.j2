# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!

server {
    listen            {{elasticsearch_proxy_port}};
    {% if elasticsearch_proxy_hostname %}server_name       {{elasticsearch_proxy_hostname}}; {% endif %}

    keepalive_timeout 0;
    proxy_read_timeout 5s;
    proxy_send_timeout 5s;
    send_timeout 5s;
    resolver_timeout 5s;
    client_body_timeout 5s;
    client_max_body_size 1024m;

    ignore_invalid_headers off;

    location / {
        proxy_pass http://{{elasticsearch_network_host}}:{{elasticsearch_http_port}};

{% if elasticsearch_http_cors_enabled %}
        add_header  "Access-Control-Allow-Origin" "{{elasticsearch_http_cors_allow_origin}}";
        add_header  "Access-Control-Allow-Methods" "{{elasticsearch_http_cors_allow_methods}}";
        add_header  "Access-Control-Allow-Credentials" "true";
        add_header  "Access-Control-Allow-Headers" "Authorization, origin, accept, content-type, content-length";
{% endif %}

        if ($request_method = 'OPTIONS' ) {

            # if request method is options we immediately return with 200 OK.
            return 200;
        }

{% if elasticsearch_proxy_auth %}
        auth_basic "Restricted";
        auth_basic_user_file {{elasticsearch_home}}/.htpasswd;
{% endif %}
    }

    error_log         {{elasticsearch_logdir}}/nginx-error.log;
    access_log        {{elasticsearch_logdir}}/nginx-access.log;

}

