- name: Gather OS Specific Variables
  include_vars: "{{ item }}"
  with_first_found:
    - "../vars/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml"
    - "../vars/{{ ansible_distribution }}.yml"
    - "../vars/{{ ansible_os_family }}.yml"
  tags: postgresql

- include: apt.yaml

- name: Install Postgres
  apt:
    pkg: {{ item }}
    state: present
    update_cache: yes
  with_items:
    - postgresql-{{pg_version}}
    - postgresql-contrib
    - libpq-dev
    - python-psycopg2
  tags: postgresql

- include: postgis.yml
  when: postgis_version is defined

- name: start postgresql and configure to startup automatically
  service:
    name: {{ postgresql_service }}
    state: started
    enabled: yes
  register: started
  tags: postgresql

- name: wait for postgresql restart
  command: sleep 2
  when: started.changed
  tags: postgresql
